FROM ubuntu:24.04

RUN apt update && apt upgrade -y && apt install -y --no-install-recommends \
    pkg-config \
    gcc git cmake libssl-dev python3 python3-pip python3-venv python3-poetry \
    pipx rustc cargo libffi-dev \
    zsh nano tmux && \
    apt clean && rm -rf /var/lib/apt/lists/*

ENV PATH=$PATH:/root/.local/bin

EXPOSE 5555

WORKDIR /projects

RUN mkdir xcp-examples

RUN git clone https://github.com/christoph2/pyxcp /tmp/pyxcp && \
    cd /tmp/pyxcp && \
    pipx install . && \
    pipx ensurepath && \
    cd /projects && \
    rm -rf /tmp/pyxcp

RUN git clone https://github.com/vectorgrp/xcplite /tmp/xcplite && \
    cd /tmp/xcplite/C_Demo && \
    cmake . && \
    cmake --build . && \
    cd /projects && \
    rm -rf /tmp/xcplite

RUN ~/.local/bin/xcp-examples xcp-examples

COPY .tmux.conf /root/.tmux.conf
COPY .zshrc /root/.zshrc

COPY pyxcp_conf.py /projects/xcp-examples/pyxcp_conf.py

CMD ["/bin/zsh"]