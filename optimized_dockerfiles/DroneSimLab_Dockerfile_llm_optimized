FROM ubuntu:xenial-20170417.1
RUN apt-get -y update && apt-get install --no-install-recommends -y software-properties-common && \
    add-apt-repository ppa:george-edison55/cmake-3.x -y && \
    apt-get -y update && \
    apt-get -y install gawk git python-pip xterm && \
    pip install --no-cache-dir --upgrade pip && \
    apt-get -y install cmake build-essential gcc unzip vim wget curl python-zmq wmctrl xdotool libprotoc-dev protobuf-compiler pkg-config libevent1-dev libncurses5-dev xclip python3-dev python3-pip python3-numpy && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
RUN echo "export PS1=\\\\\\\\w\\$" >> /etc/bash.bashrc
ENV LC_CTYPE=C.UTF-8
RUN cd /tmp && git clone https://github.com/tmux/tmux.git && cd tmux && git checkout tags/2.3
RUN apt-get -y update && apt-get install --no-install-recommends -y automake && \
    cd /tmp/tmux && sh ./autogen.sh && ./configure && make install && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get -y update && apt-get install --no-install-recommends -y python3-dev python3-pip python3-numpy && \
    pip3 install --upgrade pip && pip3 install pyzmq && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
RUN echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list
RUN apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
RUN apt-get -y update && apt-get -y --allow-unauthenticated install ros-kinetic-desktop-full python-wstool python-rosinstall-generator python-catkin-tools gazebo7 libgazebo7-dev ros-kinetic-mavros ros-kinetic-mavros-extras && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
RUN /opt/ros/kinetic/lib/mavros/install_geographiclib_datasets.sh
RUN apt-get -y update && apt-get install --no-install-recommends -y ros-kinetic-image-pipeline libglew-dev && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
RUN cd /tmp && git clone https://github.com/stevenlovegrove/Pangolin.git
RUN cd /tmp/Pangolin && git checkout tags/v0.5 && mkdir build && cd build && cmake .. && make
RUN apt-get -y update && apt-get install --no-install-recommends -y libjpeg8-dev libtiff5-dev libjasper-dev libpng12-dev libavcodec-dev libavformat-dev libswscale-dev libv4l-dev libgtk2.0-dev libatlas-base-dev gfortran && \
    git clone https://github.com/Itseez/opencv.git && cd /opencv && git checkout 3.2.0 && \
    git clone https://github.com/Itseez/opencv_contrib.git && cd /opencv_contrib && git checkout 3.2.0 && \
    cd /opencv && mkdir build && cd /opencv/build && cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local \
    -D OPENCV_EXTRA_MODULES_PATH=/opencv_contrib/modules -D WITH_IPP=OFF -D PYTHON3_PACKAGES_PATH=/usr/local/lib/python3.5/dist-packages .. && make -j6 && make install && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
RUN apt-get -y update && apt-get install --no-install-recommends -y sudo libprotobuf-dev && \
    pip3 install pyyaml rospkg catkin_pkg && \
    apt-get install --no-install-recommends -y python-jinja2 && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
RUN curl -o run.sh https://raw.githubusercontent.com/PX4/Devguide/v1.9.0/build_scripts/ubuntu_sim.sh && chmod +x ./run.sh && ./run.sh
RUN pip2 install pydy
ARG UID
RUN useradd -u $UID docker
RUN echo "docker:docker" | chpasswd
RUN echo "docker ALL=(ALL:ALL) NOPASSWD:ALL" >> /etc/sudoers